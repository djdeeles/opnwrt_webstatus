<?php

function ping($hostname, $host, $timeout ) {
	@exec("ping -W1 -c1 $host",$result);
	$result = (int)get_string_between($result[1], "time=", "ms");
	if ($result == 0) { $colorresult = "<span class='server'>$hostname: </span><font color='red'>Offline</font>"; }
	else if ($result < 150){ $colorresult = "<span class='server'>$hostname: </span><font color='green'>$result ms</font>"; }
	else if ($result < 300){ $colorresult = "<span class='server'>$hostname: </span><font color='orange'>$result ms</font>"; }
	else if ($result > 300){ $colorresult = "<span class='server'>$hostname: </span><font color='red'>$result ms</font>"; }	

	return $colorresult;
}


	exec("vnstat -i eth0.2 -tr 2",$out);
	$out = str_replace(' ', '', $out);
	$rout = explode("rx ", $out[3]);
	$tout = explode("rx ", $out[4]);

	$rx = get_string_between($rout[0], "rx", "/s");
	if(strpos($rx,'MB') == true) { $rx = intval($rx * 1024); } else { $rx = (int)$rx; }
	$rxpercent = round($rx/$GLOBALS['rxlimit']*100,0);
	if( $rxpercent > 100){ $rxpercent = "100";}

	$tx = get_string_between($tout[0], "tx", "/s");
	if(strpos($tx,'MB') == true) { $tx = intval($tx * 1024); } else { $tx = (int)$tx; }
	$txpercent = round($tx/$GLOBALS['txlimit']*100,0);
	if( $txpercent > 100){ $txpercent = "100";}





	if( session_id() == null ) { session_start(); }

	if (isset($_GET['logout'])) {
		setcookie("authentication", null, time()-1);
		session_destroy();
		$loggedin = false ;
		header("Location: ". $_SERVER['HTTP_REFERER']);
		return;
	}

	$secretusername = "root";
	$secretpassword = "051984";
	$logininfo = sha1(secretusername&secretpassword);

	if ($_SESSION['authenticated'] == true ) { 
		$loggedin = true; 
		return; 
	}
	else if ($_COOKIE["authentication"] == $logininfo ) {
		$_SESSION['authenticated'] = true;
		$loggedin = true;
		return;
	} 

	if (!empty($_POST)){
		if ($_POST['username'] == $secretusername && $_POST['password'] == $secretpassword ) {   
			$_SESSION['authenticated'] = true;
			$loggedin = true ;
			if (isset($_POST['remember'])) { setcookie("authentication", $logininfo, time()+60*60*24*30 , "/" , ".".preg_replace('/^www\./','', $host)); }
			header("Location: ". $_SERVER['HTTP_REFERER']);
		}
		else {
			$error = 'Incorrect username or password';
			$loggedin = false ;
		}
	}

	
?>